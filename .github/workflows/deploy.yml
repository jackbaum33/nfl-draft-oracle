name: Deploy to GitHub Pages

on:
  push:
    branches: [main]
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Setup Pages
        uses: actions/configure-pages@v4
      
      - name: Find and copy HTML
        run: |
          mkdir -p _site
          
          echo "üìÅ Repository structure:"
          find . -name "*.html" -type f | grep -v node_modules | head -20
          
          # Try to find index.html
          if [ -f "nfl-draft-oracle/public/index.html" ]; then
            echo "‚úÖ Found at: nfl-draft-oracle/public/index.html"
            cp nfl-draft-oracle/public/index.html _site/index.html
          elif [ -f "public/index.html" ]; then
            echo "‚úÖ Found at: public/index.html"
            cp public/index.html _site/index.html
          elif [ -f "index.html" ]; then
            echo "‚úÖ Found at: index.html"
            cp index.html _site/index.html
          else
            echo "‚ùå ERROR: Could not find index.html!"
            exit 1
          fi
          
          # Replace localhost with Vercel URL
          # TODO: Replace YOUR_VERCEL_URL with your actual Vercel URL
          VERCEL_URL="http://nfl-draft-oracle.vercel.app/"
          
          if [ "$VERCEL_URL" != "YOUR_VERCEL_URL" ]; then
            sed -i "s|const API_ENDPOINT = '/api/openai'|const API_ENDPOINT = 'https://$VERCEL_URL/api/openai'|g" _site/index.html
            sed -i "s|const DB_URL = '/database/nfl_draft.db'|const DB_URL = 'https://$VERCEL_URL/database/nfl_draft.db'|g" _site/index.html
            echo "‚úÖ Updated URLs to use Vercel: $VERCEL_URL"
          else
            echo "‚ö†Ô∏è WARNING: VERCEL_URL not set, URLs will point to localhost"
          fi
          
          echo "üì¶ Deployment contents:"
          ls -lah _site/
          
          echo "üìÑ Verifying index.html exists:"
          head -20 _site/index.html
      
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: '_site'
      
      - name: Deploy to GitHub Pages
        uses: actions/deploy-pages@v4